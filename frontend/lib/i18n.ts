export type Locale = "ko" | "en";

type Params = Record<string, string | number>;

type Dictionary = Record<string, string>;

type Dictionaries = {
  en: Dictionary;
  ko: Dictionary;
};

const rawLocale = process.env.NEXT_PUBLIC_LOCALE ?? "ko";
export const locale: Locale = rawLocale.toLowerCase().startsWith("en") ? "en" : "ko";
export const htmlLang = locale === "en" ? "en" : "ko";
export const dateLocale = locale === "en" ? "en-US" : "ko-KR";
export const isEnglish = locale === "en";

const dictionaries: Dictionaries = {
  en: {
    "nav.prepare": "Meeting Prep",
    "nav.principles": "Principles",
    "common.loading": "Loading...",
    "common.none": "None",
    "common.cancel": "Cancel",
    "common.confirm": "Confirm",
    "common.add": "Add",
    "common.save": "Save",
    "common.saved": "Saved",
    "common.delete": "Delete",
    "common.dismiss": "Dismiss",
    "common.start": "Start",
    "common.stop": "Stop",
    "common.offline": "Offline",
    "common.connected": "Connected",
    "common.agentMode": "Agent Mode",
    "common.agentStopped": "Stop Agent",
    "common.agentStart": "Start Agent",
    "common.audioStart": "Start Audio",
    "common.mute": "Mute",
    "common.unmute": "Unmute",
    "common.endMeeting": "End Meeting",
    "common.edit": "Edit",
    "common.na": "N/A",
    "home.noDate": "No date info",
    "home.tab.prepare": "New Meeting",
    "home.tab.history": "Past Meetings",
    "home.title": "Meeting Prep",
    "home.subtitle": "Define the title, participants, and principles to start a productive discussion.",
    "home.pasteMeeting": "Paste Meeting",
    "home.pasteDialogTitle": "Paste Meeting",
    "home.pasteDialogDesc": "Paste your Google Calendar content and we will auto-fill the fields.",
    "home.pastePlaceholder": "Example: Chatbot UI planning\nJan 20 (Tue) · 10:00 AM – 10:30 AM\n2 guests",
    "home.pasteAction": "Fill from Paste",
    "home.meetingTitle": "Meeting Title",
    "home.meetingTitlePlaceholder": "e.g. Weekly Sprint Review",
    "home.participants": "Participants",
    "home.defaultAgilePrinciples": "Agile principles",
    "home.participantName": "Name",
    "home.participantRole": "Role",
    "home.principles": "Principles to Apply",
    "home.selectedPrinciples": "Selected Principles",
    "home.selectedPrinciplesEmpty": "No principles selected yet. Pick from the right.",
    "home.agenda": "Agenda & References",
    "home.agendaPlaceholder": "## Today's agenda\n\n1. Sprint retrospective\n2. Next sprint planning",
    "home.startAudio": "Start Audio Meeting",
    "home.startAgent": "Start Agent Meeting",
    "home.pastMeetings": "Past Meetings",
    "home.pastMeetingsEmpty": "No saved meetings.",
    "home.pastMeetingsError": "Failed to load past meetings.",
    "home.pastMeetingsLoading": "Loading...",
    "home.meetingPasteHint": "Paste meeting",
    "home.calendarIgnoreGreeting": "Hello",
    "home.calendarIgnoreGuests": "guests",
    "home.calendarIgnoreKeywords": "Invite",
    "home.calendarStatusKeywords": "Free,Busy,Tentative",
    "home.calendarRoles": "Organizer,Host,Required attendee,Optional attendee",
    "home.badgeTotal": "Total {count}",
    "home.badgePresetCustom": "Preset {preset} · Custom {custom}",
    "home.statusTranscripts": "transcript",
    "home.statusInterventions": "interventions",
    "meeting.liveTranscript": "Live Transcript",
    "meeting.speakerStats": "Speaker Stats",
    "meeting.currentAgenda": "Current Agenda",
    "meeting.agendaEmpty": "Agenda is not set.",
    "meeting.participantsMissing": "Cannot start agent mode without participants.",
    "meeting.status.connected": "Connected",
    "meeting.status.agent": "Agent Mode",
    "meeting.status.offline": "Offline",
    "meeting.rec": "REC",
    "meeting.audioStart": "Start Audio",
    "meeting.unmute": "Unmute",
    "meeting.mute": "Mute",
    "meeting.stopAgent": "Stop Agent",
    "meeting.agentMode": "Agent Mode",
    "meeting.end": "End Meeting",
    "meeting.saveFailed": "Meeting save failed",
    "meeting.saveError": "Failed to save meeting",
    "meeting.saved": "Meeting saved",
    "review.saved": "Meeting files saved",
    "review.summaryTitle": "Meeting Summary",
    "review.participants": "Participants",
    "review.utterances": "Utterances",
    "review.interventions": "Agent interventions",
    "review.speakerStats": "Participation distribution",
    "review.speakerStatsEmpty": "No participant data",
    "review.interventionLog": "Agent intervention log",
    "review.interventionEmpty": "No interventions",
    "review.savedFiles": "Saved files",
    "review.preparationFile": "preparation.md - meeting prep",
    "review.transcriptFile": "transcript.md - full transcript",
    "review.interventionsFile": "interventions.md - agent interventions",
    "review.summaryFile": "summary.md - meeting summary",
    "review.startNew": "Start a new meeting",
    "review.actionItemsTitle": "Action Items",
    "review.actionItemsLoading": "Generating action items...",
    "review.actionItemsError": "Failed to load action items.",
    "review.actionItemsEmpty": "No action items recorded.",
    "review.actionItemOwner": "Owner: {owner}",
    "review.actionItemOwnerUnknown": "Owner: TBD",
    "review.actionItemDue": "Due: {due}",
    "review.actionItemDueNone": "Due: none",
    "history.loading": "Loading...",
    "history.loadError": "Failed to load meeting details.",
    "history.summaryTitle": "Meeting Summary",
    "history.speakerStats": "Participation distribution",
    "history.speakerStatsEmpty": "No participant data",
    "history.interventionLog": "Agent intervention log",
    "history.interventionEmpty": "No interventions",
    "history.savedFiles": "Saved files",
    "history.preparationFile": "preparation.md - meeting prep",
    "history.transcriptFile": "transcript.md - full transcript",
    "history.interventionsFile": "interventions.md - agent interventions",
    "history.summaryFile": "summary.md - meeting summary",
    "history.startNew": "Start a new meeting",
    "history.meetingLabel": "Meeting",
    "history.participantsLabel": "Participants",
    "history.utterancesLabel": "Utterances",
    "history.interventionsLabel": "Agent interventions",
    "history.actionItemsTitle": "Action Items",
    "history.actionItemsEmpty": "No action items recorded.",
    "history.actionItemOwner": "Owner: {owner}",
    "history.actionItemOwnerUnknown": "Owner: TBD",
    "history.actionItemDue": "Due: {due}",
    "history.actionItemDueNone": "Due: none",
    "principles.title": "Principles",
    "principles.subtitle": "Document shared principles to keep meetings aligned.",
    "principles.total": "Total {count}",
    "principles.presetCustom": "Preset {preset} · Custom {custom}",
    "principles.add": "Add principle",
    "principles.addTitle": "Add principle",
    "principles.addDesc": "Draft a principle name and outline to get started quickly.",
    "principles.nameLabel": "Principle name",
    "principles.namePlaceholder": "e.g. Design sprint principles",
    "principles.contentLabel": "Draft content",
    "principles.contentPlaceholder": "# Principle title\n\n1. ...",
    "principles.addAction": "Add",
    "principles.sourcePreset": "Preset",
    "principles.sourceCustom": "Custom",
    "principles.guideTitle": "Writing guide",
    "principles.guideMarkdown": "Use Markdown for easy reading.",
    "principles.guideCore": "Keep core principles to 3–6 concise points.",
    "principles.guideActions": "Start behavior rules with verbs.",
    "principles.guideConflict": "Add one line about conflict resolution.",
    "principles.editorHint": "Edit the shared principles document freely.",
    "principles.deleteConfirm": "Delete this principle?",
    "intervention.topic": "Topic drift",
    "intervention.principle": "Principle violation",
    "intervention.participation": "Participation imbalance",
    "intervention.decision": "Decision style",
    "intervention.violated": "Violated principle: {principle}",
    "intervention.dismiss": "Dismiss",
    "intervention.confirm": "Acknowledge",
    "transcript.avgLatency": "Recent transcription latency: {latency}ms (avg of last 10)",
    "speakerStats.imbalance": "Participation imbalance",
    "speakerStats.percentageCount": "{percentage}% ({count} turns)",
    "home.participantRoleOptions": "Organizer,Attendee,Required attendee,Optional attendee",
    "history.noDate": "No date info",
    "review.noDate": "No date info",
    "principles.placeholderPreset": "Preset",
    "principles.placeholderCustom": "Custom"
  },
  ko: {
    "nav.prepare": "회의 준비",
    "nav.principles": "원칙 관리",
    "common.loading": "불러오는 중...",
    "common.none": "없음",
    "common.cancel": "취소",
    "common.confirm": "확인",
    "common.add": "추가",
    "common.save": "저장",
    "common.saved": "저장됨",
    "common.delete": "삭제",
    "common.dismiss": "무시",
    "common.start": "시작",
    "common.stop": "중지",
    "common.offline": "오프라인",
    "common.connected": "연결됨",
    "common.agentMode": "에이전트 모드",
    "common.agentStopped": "에이전트 중지",
    "common.agentStart": "에이전트 모드",
    "common.audioStart": "오디오 시작",
    "common.mute": "음소거",
    "common.unmute": "음소거 해제",
    "common.endMeeting": "회의 종료",
    "common.edit": "편집",
    "common.na": "N/A",
    "home.noDate": "날짜 정보 없음",
    "home.tab.prepare": "새 회의",
    "home.tab.history": "지난 회의",
    "home.title": "회의 준비",
    "home.subtitle": "회의 제목과 참석자, 원칙을 미리 정리해 생산적인 논의를 시작하세요.",
    "home.pasteMeeting": "회의 붙여넣기",
    "home.pasteDialogTitle": "회의 붙여넣기",
    "home.pasteDialogDesc": "Google Calendar에서 복사한 내용을 그대로 붙여넣으면 자동으로 입력해요.",
    "home.pastePlaceholder": "예: 챗봇 화면 기획 논의\n1월 20일 (화요일)⋅AM 10:00~ 10:30\n참석자 2명",
    "home.pasteAction": "입력하기",
    "home.meetingTitle": "회의 제목",
    "home.meetingTitlePlaceholder": "예: 주간 스프린트 리뷰",
    "home.participants": "참석자",
    "home.defaultAgilePrinciples": "Agile 원칙",
    "home.participantName": "이름",
    "home.participantRole": "역할",
    "home.principles": "적용할 회의 원칙",
    "home.selectedPrinciples": "선택된 회의 원칙",
    "home.selectedPrinciplesEmpty": "아직 선택된 원칙이 없어요. 오른쪽에서 원칙을 선택해 주세요.",
    "home.agenda": "아젠다 & 참고 자료",
    "home.agendaPlaceholder": "## 오늘의 아젠다\n\n1. 지난 스프린트 회고\n2. 다음 스프린트 계획",
    "home.startAudio": "오디오 회의 시작",
    "home.startAgent": "에이전트 회의 시작",
    "home.pastMeetings": "지난 회의",
    "home.pastMeetingsEmpty": "저장된 회의가 없습니다.",
    "home.pastMeetingsError": "지난 회의를 불러오지 못했어요.",
    "home.pastMeetingsLoading": "불러오는 중...",
    "home.meetingPasteHint": "회의 붙여넣기",
    "home.calendarIgnoreGreeting": "안녕하세요",
    "home.calendarIgnoreGuests": "명",
    "home.calendarIgnoreKeywords": "초대",
    "home.calendarStatusKeywords": "한가함,바쁨,미정",
    "home.calendarRoles": "주최자,참석자,필수 참석자,선택 참석자",
    "home.badgeTotal": "총 {count}개",
    "home.badgePresetCustom": "기본 {preset} · 커스텀 {custom}",
    "home.statusTranscripts": "전사",
    "home.statusInterventions": "개입",
    "meeting.liveTranscript": "실시간 자막",
    "meeting.speakerStats": "발언 통계",
    "meeting.currentAgenda": "현재 아젠다",
    "meeting.agendaEmpty": "아젠다가 설정되지 않았습니다.",
    "meeting.participantsMissing": "참석자가 없으면 에이전트 모드를 시작할 수 없습니다.",
    "meeting.status.connected": "연결됨",
    "meeting.status.agent": "에이전트 모드",
    "meeting.status.offline": "오프라인",
    "meeting.rec": "REC",
    "meeting.audioStart": "오디오 시작",
    "meeting.unmute": "음소거 해제",
    "meeting.mute": "음소거",
    "meeting.stopAgent": "에이전트 중지",
    "meeting.agentMode": "에이전트 모드",
    "meeting.end": "회의 종료",
    "meeting.saveFailed": "회의 저장 실패",
    "meeting.saveError": "회의 저장 실패",
    "meeting.saved": "회의 저장 완료",
    "review.saved": "회의록이 저장되었습니다",
    "review.summaryTitle": "회의 요약",
    "review.participants": "참석자",
    "review.utterances": "발화 수",
    "review.interventions": "Agent 개입",
    "review.speakerStats": "참여도 분포",
    "review.speakerStatsEmpty": "참석자 정보 없음",
    "review.interventionLog": "Agent 개입 기록",
    "review.interventionEmpty": "개입 없음",
    "review.savedFiles": "저장된 파일",
    "review.preparationFile": "preparation.md - 회의 준비 자료",
    "review.transcriptFile": "transcript.md - 전체 녹취록",
    "review.interventionsFile": "interventions.md - Agent 개입 기록",
    "review.summaryFile": "summary.md - 회의 요약",
    "review.startNew": "새 회의 시작",
    "review.actionItemsTitle": "Action Items",
    "review.actionItemsLoading": "Action Item을 생성 중입니다...",
    "review.actionItemsError": "Action Item을 불러오지 못했어요.",
    "review.actionItemsEmpty": "등록된 Action Item이 없습니다.",
    "review.actionItemOwner": "담당자: {owner}",
    "review.actionItemOwnerUnknown": "담당자 미정",
    "review.actionItemDue": "기한: {due}",
    "review.actionItemDueNone": "기한 없음",
    "history.loading": "불러오는 중...",
    "history.loadError": "회의 상세 정보를 불러오지 못했어요.",
    "history.summaryTitle": "회의 요약",
    "history.speakerStats": "참여도 분포",
    "history.speakerStatsEmpty": "참석자 정보 없음",
    "history.interventionLog": "Agent 개입 기록",
    "history.interventionEmpty": "개입 없음",
    "history.savedFiles": "저장된 파일",
    "history.preparationFile": "preparation.md - 회의 준비 자료",
    "history.transcriptFile": "transcript.md - 전체 녹취록",
    "history.interventionsFile": "interventions.md - Agent 개입 기록",
    "history.summaryFile": "summary.md - 회의 요약",
    "history.startNew": "새 회의 시작",
    "history.meetingLabel": "회의",
    "history.participantsLabel": "참석자",
    "history.utterancesLabel": "발화 수",
    "history.interventionsLabel": "Agent 개입",
    "history.actionItemsTitle": "Action Items",
    "history.actionItemsEmpty": "등록된 Action Item이 없습니다.",
    "history.actionItemOwner": "담당자: {owner}",
    "history.actionItemOwnerUnknown": "담당자 미정",
    "history.actionItemDue": "기한: {due}",
    "history.actionItemDueNone": "기한 없음",
    "principles.title": "회의 원칙 관리",
    "principles.subtitle": "회의가 흐트러지지 않도록 팀의 합의된 기준을 정리하고 공유하세요.",
    "principles.total": "총 {count}개",
    "principles.presetCustom": "기본 {preset} · 커스텀 {custom}",
    "principles.add": "새 원칙 추가",
    "principles.addTitle": "새 원칙 추가",
    "principles.addDesc": "팀 이름에 맞는 원칙 이름과 초안을 적어두면 빠르게 시작할 수 있어요.",
    "principles.nameLabel": "원칙 이름",
    "principles.namePlaceholder": "예: 디자인 스프린트 원칙",
    "principles.contentLabel": "초안 내용",
    "principles.contentPlaceholder": "# 원칙 제목\n\n1. ...",
    "principles.addAction": "추가하기",
    "principles.sourcePreset": "기본",
    "principles.sourceCustom": "커스텀",
    "principles.guideTitle": "작성 가이드",
    "principles.guideMarkdown": "Markdown 형식으로 작성하면 팀원들이 읽기 쉬워요.",
    "principles.guideCore": "핵심 원칙은 3~6개로 간결하게 정리하세요.",
    "principles.guideActions": "행동 기준은 동사로 시작하면 명확해집니다.",
    "principles.guideConflict": "갈등 해결 방식을 한 줄로 추가하세요.",
    "principles.editorHint": "팀이 공유할 원칙 문서를 자유롭게 편집하세요.",
    "principles.deleteConfirm": "이 원칙을 삭제할까요?",
    "intervention.topic": "주제 이탈",
    "intervention.principle": "원칙 위반",
    "intervention.participation": "발언 불균형",
    "intervention.decision": "의사결정 방식",
    "intervention.violated": "위반 원칙: {principle}",
    "intervention.dismiss": "무시",
    "intervention.confirm": "확인",
    "transcript.avgLatency": "최근 전사 지연: {latency}ms (최근 10개 평균)",
    "speakerStats.imbalance": "참여 불균형",
    "speakerStats.percentageCount": "{percentage}% ({count}회)",
    "home.participantRoleOptions": "주최자,참석자,필수 참석자,선택 참석자",
    "history.noDate": "날짜 정보 없음",
    "review.noDate": "날짜 정보 없음",
    "principles.placeholderPreset": "기본",
    "principles.placeholderCustom": "커스텀"
  }
};

export const t = (key: string, params?: Params): string => {
  const template = dictionaries[locale][key] ?? dictionaries.en[key] ?? key;
  if (!params) return template;
  return template.replace(/\{(\w+)\}/g, (_match, token) => {
    const value = params[token];
    return value === undefined ? "" : String(value);
  });
};

export const formatDateTime = (value?: string | null, options?: Intl.DateTimeFormatOptions) => {
  if (!value) return t("home.noDate");
  const parsed = new Date(value);
  if (Number.isNaN(parsed.getTime())) return value;
  return parsed.toLocaleString(dateLocale, options ?? {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
  });
};

export const formatTime = (value: string | number | Date, options?: Intl.DateTimeFormatOptions) => {
  const parsed = new Date(value);
  if (Number.isNaN(parsed.getTime())) return String(value);
  return parsed.toLocaleTimeString(dateLocale, options ?? {
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
  });
};
